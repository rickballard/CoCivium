# CoWrap_HA_Frigate_2025-09-11_03-38-03 - Intake (2025-09-11_044919Z)
Source: C:\Users\Chris\Downloads\CoTemp\intake\unzipped\unz_2025-09-11_042802Z\CoWrap_HA_Frigate_2025-09-11_03-38-03

## README.md
# CoWrap: Home Assistant + Frigate
Generated: 2025-09-11_03-38-03

This bundle captures the current state, decisions, and next actions for your Home Assistant + Frigate setup.
Use this as a handoff package or to resume work later.

**IMPORTANT (Security):** This archive includes SECRETS.txt with credentials _you asked to include_. Treat this as sensitive and store securely.


## Achievements.md
# Achievements

- Brought Home Assistant (HA) out of repeated Recovery/Safe Mode by fixing Lovelace dashboard keys (hyphenated URL key) and removing Frigate-only blocks from `configuration.yaml`.
- Enabled HACS in the HA sidebar.
- Verified all four Reolink cameras stream via RTSP in VLC with `admin / ReoRick2025..`.
- Consolidated Frigate config to the **actual** add-on config file: `/addon_configs/ccab4aaf_frigate/config.yml` (also editable via Frigate UI â†’ â‹® â†’ Configuration Editor).
- Brought up **4 cameras** in Frigate UI (Driveway, Front, Front Rental, Back Yard).
- Implemented motion pop-up UX plan (Browser Mod automations & 15s motion-hold sensors).
- Resolved cyclic restarts in part by temporarily running CPU detector while Coral USB stability was improved (powered hub).


## KnownIssues.md
# Known Issues & Mitigations

## 1) Frigate restarts with Coral USB (EdgeTPU)
- Symptom: Logs show `USB transfer error 2`, fatal abort, watchdog restarts detection.
- Mitigations:
  - Use **CPU detector** temporarily:
    ```yaml
    detectors:
      cpu1:
        type: cpu
    # coral:
    #   type: edgetpu
    #   device: usb
    ```
  - Plug Coral **directly** into a stable USB3 port or a **quality powered** USB3 hub using a **short cable**.
  - After moving it, re-enable `coral` and confirm logs show EdgeTPU delegate without USB errors.

## 2) Reolink `no frames received` (e.g., Front Rental)
- Causes:
  - Wrong RTSP credentials/IP/path **from the Frigate containerâ€™s perspective**.
  - Too many simultaneous RTSP connections (phone app open; each camera has limits).
  - Codec/profile mismatch; substream disabled.
- Steps:
  - Confirm **both** sub and main play in **VLC**:
    - `rtsp://admin:ReoRick2025..@<ip>:554/h264Preview_01_sub`
    - `rtsp://admin:ReoRick2025..@<ip>:554/h264Preview_01_main`
  - In Reolink app:
    - Ensure **RTSP ON**, port **554**.
    - **Fluent/substream ON**, codec **H.264**, FPS ~5, resolution ~640x360.
    - Close the Reolink app while Frigate connects.
  - In Frigate, reduce RTSP sessions temporarily:
    - Remove `roles: [record]` (leave only `detect`) for that camera to test.
  - Optional: re-stream via go2rtc to consolidate connections (advanced).

## 3) HA Safe Mode (Recovery)
- Common triggers:
  - Invalid `lovelace.dashboards` key (use **hyphens**, not underscores).
  - Putting Frigate's `detectors:`/`cameras:` into `configuration.yaml`.
- Fix: Correct the YAML, `ha core check`, then restart.


## NextSteps.md
# Next Steps (Actionable)

1. **Stabilize Coral**: run CPU for now; move Coral to direct USB3 or quality powered hub; then re-enable `edgetpu` and confirm clean logs.
2. **Front Rental no-frames**: verify in VLC; temporarily drop the `record` role; ensure substream H.264; close phone app; re-test; then re-add recording.
3. **Finalize motion popups**: confirm `browser_mod` installed; import `AUTOMATIONS/motion_popups.yaml`; verify `*_motion_hold` sensors exist; trigger motion and confirm 15s auto-close.
4. **Cameras dashboard**: keep YAML dashboard `home-plus-cameras`; adjust entities to your actual names under Developer Tools â†’ States.
5. **NAS storage (later)**: mount SMB share via HA **Mounts**; set Frigate `database.path` and `record` storage to `/media/frigate`; verify free space & retention policy.
6. **Tablet**: choose Android tablet + Fully Kiosk Browser; point to the Home dashboard; set screen-on + kiosk; use `browser_mod` `browser_id` to target that tablet only for popups.


## Workflows.md
# Workflows (Commands & Where Things Live)

## HA / Supervisor CLI
- List add-ons and find Frigate slug:
  ```bash
  ha addons list | grep -i frigate
  ```
- Show add-on logs:
  ```bash
  ha addons logs ccab4aaf_frigate --lines 400
  ```
- Restart add-on:
  ```bash
  ha addons restart ccab4aaf_frigate
  ```
- Validate HA config & restart core:
  ```bash
  ha core check
  ha core restart
  ```

## Frigate config locations (HA add-on)
- **Live config (source of truth):** `/addon_configs/ccab4aaf_frigate/config.yml`
  - The Frigate Web UI **Configuration Editor** writes to this file.
- **Do NOT use** Add-on â†’ Options YAML for Frigate config (keep it empty).
- **Do NOT use** `/config/frigate/config.yml` for the HA add-on (only for docker/manual installs).

## Lovelace dashboards
- In `configuration.yaml`:
  ```yaml
  lovelace:
    dashboards:
      home-plus-cameras:
        mode: yaml
        title: Home + Cameras
        show_in_sidebar: true
        icon: mdi:cctv
        filename: dashboards/home_control_plus_cameras.yaml
  ```
- Dashboard file must start with `title:` and `views:` â€” not `dashboards:`.

## Motion popups (Browser Mod)
- Requires HACS â†’ install **browser_mod**.
- Automations live in `automations.yaml` or as included package; sample is in `AUTOMATIONS/motion_popups.yaml`.
- Sensors with 15s "hold" live in `configuration.yaml` (template binary_sensors) or an include:
  ```yaml
  template:
    - binary_sensor:
        - name: "Driveway Motion (hold)"
          unique_id: driveway_motion_hold
          state: "{{ is_state('binary_sensor.driveway_motion','on') }}"
          delay_off: "00:00:15"
        # repeat for other cameras...
  ```


